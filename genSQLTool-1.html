<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†è¡¨å»ºè¡¨è¯­å¥ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fb;
            color: #333;
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        /* å·¦ä¾§è¾“å…¥é¢æ¿ */
        .input-panel {
            width: 40%;
            background-color: white;
            border-right: 1px solid #d1d9e6;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
        }
        
        .panel-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #4a6fa5;
        }
        
        .panel-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .panel-subtitle {
            font-size: 13px;
            color: #6c757d;
            margin-top: 5px;
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: #495057;
            font-size: 14px;
        }
        
        .form-hint {
            font-size: 12px;
            color: #6c757d;
            margin-top: 4px;
        }
        
        .form-control {
            width: 100%;
            padding: 9px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-control:focus {
            border-color: #4a6fa5;
            outline: none;
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }
        
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
            font-family: 'Courier New', monospace;
            line-height: 1.4;
        }
        
        .date-range-group {
            display: flex;
            gap: 12px;
        }
        
        .date-input-wrapper {
            flex: 1;
            position: relative;
        }
        
        .month-picker-btn {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 40px;
            background-color: #f8f9fa;
            border: 1px solid #ced4da;
            border-left: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            color: #495057;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .month-picker-btn:hover {
            background-color: #e9ecef;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 9px 18px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .btn-primary {
            background-color: #4a6fa5;
            color: white;
            flex: 2;
        }
        
        .btn-primary:hover {
            background-color: #3d5a80;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
            flex: 1;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        /* å³ä¾§è¾“å‡ºé¢æ¿ */
        .output-panel {
            width: 60%;
            background-color: white;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
        }
        
        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .output-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .output-stats {
            font-size: 13px;
            color: #6c757d;
        }
        
        .copy-btn {
            background-color: #28a745;
            color: white;
            padding: 6px 14px;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
        }
        
        .copy-btn:hover {
            background-color: #218838;
        }
        
        .sql-output {
            flex: 1;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            overflow-y: auto;
        }
        
        /* æœˆä»½é€‰æ‹©å™¨ */
        .month-picker {
            position: absolute;
            background: white;
            border: 1px solid #ced4da;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            width: 220px;
            padding: 12px;
            display: none;
        }
        
        .month-picker.active {
            display: block;
        }
        
        .picker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .picker-year {
            font-weight: 600;
            font-size: 15px;
        }
        
        .picker-nav {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: #495057;
            width: 30px;
            height: 30px;
            border-radius: 4px;
        }
        
        .picker-nav:hover {
            background-color: #f8f9fa;
        }
        
        .month-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }
        
        .month-option {
            padding: 8px 4px;
            text-align: center;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .month-option:hover {
            background-color: #e9ecef;
        }
        
        .month-option.selected {
            background-color: #4a6fa5;
            color: white;
        }
        
        .cache-status {
            font-size: 12px;
            color: #28a745;
            margin-top: 5px;
            display: none;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 900px) {
            .app-container {
                flex-direction: column;
                height: auto;
                overflow-y: auto;
            }
            
            .input-panel, .output-panel {
                width: 100%;
                height: 50vh;
            }
            
            .input-panel {
                border-right: none;
                border-bottom: 1px solid #dee2e6;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- å·¦ä¾§è¾“å…¥é¢æ¿ -->
        <div class="input-panel">
            <div class="panel-header">
                <div class="panel-title">âš™ï¸ è¾“å…¥é…ç½®</div>
                <div class="panel-subtitle">é…ç½®è¡¨åã€å‚è€ƒæœˆä»½å’Œåˆ†è¡¨æœˆä»½èŒƒå›´ï¼ˆè‡ªåŠ¨ä¿å­˜ï¼‰</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">è¡¨åï¼ˆæ”¯æŒä»Excelå¤åˆ¶ï¼Œæ”¯æŒæ¢è¡Œã€Tabã€é€—å·åˆ†éš”ï¼‰</label>
                <textarea id="tableNames" class="form-control" placeholder="ä»Excelå¤åˆ¶è¡¨åï¼Œæ”¯æŒæ¢è¡Œã€Tabã€é€—å·åˆ†éš”"></textarea>
                <div class="form-hint">æ”¯æŒä»ExcelæŒ‰è¡Œæˆ–åˆ—å¤åˆ¶ï¼Œè‡ªåŠ¨è¯†åˆ«æ¢è¡Œç¬¦ã€åˆ¶è¡¨ç¬¦ã€é€—å·åˆ†éš”</div>
                <div id="tableNamesCache" class="cache-status">å·²ä¿å­˜</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">å‚è€ƒè¡¨æœˆä»½ï¼ˆå·²æœ‰è¡¨çš„æœˆä»½ï¼‰</label>
                <div class="date-input-wrapper">
                    <input type="text" id="refMonth" class="form-control" placeholder="ç‚¹å‡»å³ä¾§æŒ‰é’®é€‰æ‹©æœˆä»½" readonly>
                    <button class="month-picker-btn" onclick="showMonthPicker('refMonth')">ğŸ“…</button>
                </div>
                <div class="form-hint">é»˜è®¤å€¼ä¸ºä¸Šä¸ªæœˆï¼ˆYYYYMMæ ¼å¼ï¼‰</div>
                <div id="refMonthCache" class="cache-status">å·²ä¿å­˜</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">åˆ†è¡¨æœˆä»½èŒƒå›´</label>
                <div class="date-range-group">
                    <div class="date-input-wrapper">
                        <input type="text" id="startMonth" class="form-control" placeholder="å¼€å§‹æœˆä»½" readonly>
                        <button class="month-picker-btn" onclick="showMonthPicker('startMonth')">ğŸ“…</button>
                    </div>
                    <div class="date-input-wrapper">
                        <input type="text" id="endMonth" class="form-control" placeholder="ç»“æŸæœˆä»½" readonly>
                        <button class="month-picker-btn" onclick="showMonthPicker('endMonth')">ğŸ“…</button>
                    </div>
                </div>
                <div class="form-hint">å¼€å§‹æœˆä»½é»˜è®¤å€¼ä¸ºä¸Šä¸Šæœˆæ‰€åœ¨å¹´ä»½çš„1æœˆï¼Œç»“æŸæœˆä»½é»˜è®¤å€¼ä¸ºä¸Šä¸Šä¸ªæœˆ</div>
                <div id="dateRangeCache" class="cache-status">å·²ä¿å­˜</div>
            </div>
            
            <div class="form-group">
                <div id="tableCountInfo" style="font-size: 13px; color: #4a6fa5; font-weight: 500;"></div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="generateSQL()">ç”Ÿæˆå»ºè¡¨è¯­å¥</button>
                <button class="btn btn-secondary" onclick="resetForm()">é‡ç½®</button>
            </div>
            
            <div style="margin-top: 20px; font-size: 12px; color: #6c757d;">
                <p><strong>ä½¿ç”¨è¯´æ˜ï¼š</strong></p>
                <ul style="padding-left: 15px; margin-top: 5px;">
                    <li><strong>è¡¨åæ ¼å¼ï¼š</strong>æ”¯æŒä»Excelç›´æ¥å¤åˆ¶ï¼Œè‡ªåŠ¨è¯†åˆ«æ¢è¡Œç¬¦ã€åˆ¶è¡¨ç¬¦ã€é€—å·åˆ†éš”</li>
                    <li><strong>å‚è€ƒæœˆä»½ï¼š</strong>å·²æœ‰è¡¨çš„æœˆä»½ï¼Œé»˜è®¤å€¼ä¸ºä¸Šä¸ªæœˆï¼ˆYYYYMMæ ¼å¼ï¼‰</li>
                    <li><strong>å¼€å§‹æœˆä»½ï¼š</strong>é»˜è®¤å€¼ä¸ºä¸Šä¸Šæœˆæ‰€åœ¨å¹´ä»½çš„1æœˆï¼ˆå¦‚ä¸Šä¸Šæœˆä¸º2025å¹´10æœˆï¼Œåˆ™é»˜è®¤2025å¹´1æœˆï¼‰</li>
                    <li><strong>ç»“æŸæœˆä»½ï¼š</strong>é»˜è®¤å€¼ä¸ºä¸Šä¸Šä¸ªæœˆï¼ˆYYYYMMæ ¼å¼ï¼‰</li>
                    <li><strong>ç”Ÿæˆæ ¼å¼ï¼š</strong>create table è¡¨å_å¹´æœˆ as (select * from è¡¨å_å‚è€ƒå¹´æœˆ where 1=0);</li>
                    <li><strong>ç¼“å­˜åŠŸèƒ½ï¼š</strong>æ‰€æœ‰è¾“å…¥è‡ªåŠ¨ä¿å­˜ï¼Œä¸‹æ¬¡æ‰“å¼€é¡µé¢è‡ªåŠ¨æ¢å¤</li>
                </ul>
            </div>
        </div>
        
        <!-- å³ä¾§è¾“å‡ºé¢æ¿ -->
        <div class="output-panel">
            <div class="output-header">
                <div class="output-title">ğŸ“„ ç”Ÿæˆçš„SQLè¯­å¥</div>
                <div>
                    <span id="resultStats" class="output-stats"></span>
                    <button class="copy-btn" onclick="copyToClipboard()">å¤åˆ¶</button>
                </div>
            </div>
            
            <div id="sqlResult" class="sql-output">
è¯·å¡«å†™å·¦ä¾§çš„é…ç½®ä¿¡æ¯ï¼Œç„¶åç‚¹å‡»"ç”Ÿæˆå»ºè¡¨è¯­å¥"æŒ‰é’®
            </div>
        </div>
    </div>
    
    <!-- æœˆä»½é€‰æ‹©å™¨ -->
    <div id="monthPicker" class="month-picker">
        <div class="picker-header">
            <button class="picker-nav" onclick="changeYear(-1)">&lt;</button>
            <span id="pickerYear" class="picker-year">2025</span>
            <button class="picker-nav" onclick="changeYear(1)">&gt;</button>
        </div>
        <div id="monthGrid" class="month-grid">
            <!-- æœˆä»½å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentYear = 2025;
        let currentInputId = null;
        const monthPicker = document.getElementById('monthPicker');
        
        // è·å–å½“å‰æ—¥æœŸçš„ä¸Šä¸€ä¸ªæœˆï¼ˆæ ¼å¼ï¼šYYYYMMï¼‰
        function getLastMonth() {
            const now = new Date();
            now.setMonth(now.getMonth() - 1);
            return now.getFullYear().toString() + (now.getMonth() + 1).toString().padStart(2, '0');
        }
        
        // è·å–ä¸Šä¸Šä¸ªæœˆï¼ˆæ ¼å¼ï¼šYYYYMMï¼‰
        function getMonthBeforeLast() {
            const now = new Date();
            now.setMonth(now.getMonth() - 2);
            return now.getFullYear().toString() + (now.getMonth() + 1).toString().padStart(2, '0');
        }
        
        // è·å–ä¸Šä¸Šæœˆæ‰€åœ¨å¹´ä»½çš„1æœˆï¼ˆæ ¼å¼ï¼šYYYY01ï¼‰
        function getFirstMonthOfYearBeforeLastMonth() {
            const now = new Date();
            now.setMonth(now.getMonth() - 2);
            return now.getFullYear().toString() + '01';
        }
        
        // åˆå§‹åŒ–æœˆä»½é€‰æ‹©å™¨
        function initMonthPicker() {
            const yearSpan = document.getElementById('pickerYear');
            const monthGrid = document.getElementById('monthGrid');
            
            // ç”Ÿæˆæœˆä»½ç½‘æ ¼
            function generateMonthGrid() {
                monthGrid.innerHTML = '';
                yearSpan.textContent = currentYear;
                
                const months = [
                    {num: '01', name: '1æœˆ'}, {num: '02', name: '2æœˆ'}, {num: '03', name: '3æœˆ'},
                    {num: '04', name: '4æœˆ'}, {num: '05', name: '5æœˆ'}, {num: '06', name: '6æœˆ'},
                    {num: '07', name: '7æœˆ'}, {num: '08', name: '8æœˆ'}, {num: '09', name: '9æœˆ'},
                    {num: '10', name: '10æœˆ'}, {num: '11', name: '11æœˆ'}, {num: '12', name: '12æœˆ'}
                ];
                
                months.forEach(month => {
                    const monthElement = document.createElement('div');
                    monthElement.className = 'month-option';
                    monthElement.textContent = month.name;
                    monthElement.dataset.month = `${currentYear}${month.num}`;
                    
                    // æ£€æŸ¥å½“å‰è¾“å…¥æ¡†çš„å€¼æ˜¯å¦ä¸æ­¤æœˆä»½åŒ¹é…
                    if (currentInputId) {
                        const inputElement = document.getElementById(currentInputId);
                        if (inputElement && inputElement.value === `${currentYear}${month.num}`) {
                            monthElement.classList.add('selected');
                        }
                    }
                    
                    monthElement.addEventListener('click', function() {
                        const selectedMonth = this.dataset.month;
                        
                        // è®¾ç½®è¾“å…¥æ¡†çš„å€¼
                        if (currentInputId) {
                            document.getElementById(currentInputId).value = selectedMonth;
                            // ä¿å­˜åˆ°ç¼“å­˜
                            saveToCache(currentInputId, selectedMonth);
                            // æ˜¾ç¤ºä¿å­˜çŠ¶æ€
                            showCacheStatus(currentInputId);
                        }
                        
                        // å…³é—­æœˆä»½é€‰æ‹©å™¨
                        hideMonthPicker();
                        
                        // æ›´æ–°è¡¨æ•°é‡ä¿¡æ¯
                        updateTableCount();
                    });
                    
                    monthGrid.appendChild(monthElement);
                });
            }
            
            // åˆå§‹ç”Ÿæˆæœˆä»½ç½‘æ ¼
            generateMonthGrid();
            
            // ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸå…³é—­æœˆä»½é€‰æ‹©å™¨
            document.addEventListener('click', function(event) {
                if (!monthPicker.contains(event.target) && 
                    !event.target.classList.contains('month-picker-btn')) {
                    hideMonthPicker();
                }
            });
        }
        
        // åˆ‡æ¢å¹´ä»½
        function changeYear(delta) {
            currentYear += delta;
            initMonthPicker();
        }
        
        // æ˜¾ç¤ºæœˆä»½é€‰æ‹©å™¨
        function showMonthPicker(inputId) {
            currentInputId = inputId;
            
            // è·å–è¾“å…¥æ¡†çš„å½“å‰å€¼
            const inputElement = document.getElementById(inputId);
            const currentValue = inputElement.value;
            
            // å¦‚æœæœ‰å€¼ï¼Œè§£æå¹´ä»½
            if (currentValue && currentValue.length === 6) {
                const year = parseInt(currentValue.substring(0, 4));
                if (!isNaN(year) && year >= 2000 && year <= 2100) {
                    currentYear = year;
                }
            } else {
                // é»˜è®¤ä½¿ç”¨å½“å‰å¹´ä»½
                const now = new Date();
                currentYear = now.getFullYear();
            }
            
            // é‡æ–°åˆå§‹åŒ–æœˆä»½é€‰æ‹©å™¨
            initMonthPicker();
            
            // æ˜¾ç¤ºæœˆä»½é€‰æ‹©å™¨
            monthPicker.classList.add('active');
            
            // å®šä½æœˆä»½é€‰æ‹©å™¨
            const inputRect = inputElement.getBoundingClientRect();
            monthPicker.style.top = (inputRect.bottom + window.scrollY + 5) + 'px';
            monthPicker.style.left = (inputRect.left + window.scrollX) + 'px';
        }
        
        // éšè—æœˆä»½é€‰æ‹©å™¨
        function hideMonthPicker() {
            monthPicker.classList.remove('active');
        }
        
        // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveToCache(key, value) {
            try {
                localStorage.setItem(`tablePartition_${key}`, value);
            } catch (e) {
                console.error('ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥:', e);
            }
        }
        
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
        function loadFromCache(key) {
            try {
                return localStorage.getItem(`tablePartition_${key}`);
            } catch (e) {
                console.error('ä»æœ¬åœ°å­˜å‚¨åŠ è½½å¤±è´¥:', e);
                return null;
            }
        }
        
        // æ¸…ç©ºç¼“å­˜
        function clearCache() {
            try {
                localStorage.removeItem('tablePartition_tableNames');
                localStorage.removeItem('tablePartition_refMonth');
                localStorage.removeItem('tablePartition_startMonth');
                localStorage.removeItem('tablePartition_endMonth');
            } catch (e) {
                console.error('æ¸…ç©ºç¼“å­˜å¤±è´¥:', e);
            }
        }
        
        // æ˜¾ç¤ºç¼“å­˜çŠ¶æ€
        function showCacheStatus(elementId) {
            const cacheElement = document.getElementById(`${elementId}Cache`);
            if (cacheElement) {
                cacheElement.style.display = 'block';
                setTimeout(() => {
                    cacheElement.style.display = 'none';
                }, 1500);
            }
        }
        
        // åˆå§‹åŒ–è¡¨å•æ•°æ®ï¼ˆä»ç¼“å­˜åŠ è½½æˆ–ä½¿ç”¨é»˜è®¤å€¼ï¼‰
        function initFormData() {
            const lastMonth = getLastMonth();
            const monthBeforeLast = getMonthBeforeLast();
            const firstMonthOfYearBeforeLastMonth = getFirstMonthOfYearBeforeLastMonth();
            
            // è¡¨å
            const cachedTableNames = loadFromCache('tableNames');
            if (cachedTableNames) {
                document.getElementById('tableNames').value = cachedTableNames;
            } else {
                document.getElementById('tableNames').value = 'EDS.TW_AGILE_GUSR_ATTR_BASE_INF_M\nEDS.TW_AGILE_GUSR_ATTR_DETAIL_M';
            }
            
            // å‚è€ƒæœˆä»½
            const cachedRefMonth = loadFromCache('refMonth');
            document.getElementById('refMonth').value = cachedRefMonth || lastMonth;
            
            // å¼€å§‹æœˆä»½
            const cachedStartMonth = loadFromCache('startMonth');
            document.getElementById('startMonth').value = cachedStartMonth || firstMonthOfYearBeforeLastMonth;
            
            // ç»“æŸæœˆä»½
            const cachedEndMonth = loadFromCache('endMonth');
            document.getElementById('endMonth').value = cachedEndMonth || monthBeforeLast;
            
            // ä¸ºè¾“å…¥æ¡†æ·»åŠ ç¼“å­˜åŠŸèƒ½
            document.getElementById('tableNames').addEventListener('input', function() {
                saveToCache('tableNames', this.value);
                showCacheStatus('tableNames');
                updateTableCount();
            });
            
            document.getElementById('refMonth').addEventListener('change', function() {
                saveToCache('refMonth', this.value);
                showCacheStatus('refMonth');
                updateTableCount();
            });
            
            document.getElementById('startMonth').addEventListener('change', function() {
                saveToCache('startMonth', this.value);
                showCacheStatus('startMonth');
                updateTableCount();
            });
            
            document.getElementById('endMonth').addEventListener('change', function() {
                saveToCache('endMonth', this.value);
                showCacheStatus('endMonth');
                updateTableCount();
            });
            
            // åˆå§‹æ›´æ–°è¡¨æ•°é‡ä¿¡æ¯
            updateTableCount();
        }
        
        // è§£æè¡¨åå­—ç¬¦ä¸²ï¼ˆæ”¯æŒæ¢è¡Œç¬¦ã€Tabã€é€—å·åˆ†éš”ï¼‰
        function parseTableNames(tableNamesText) {
            if (!tableNamesText) return [];
            
            // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²ï¼šæ¢è¡Œç¬¦ã€Tabã€é€—å·
            return tableNamesText
                .split(/[\n\t,]+/)
                .map(name => name.trim())
                .filter(name => name.length > 0);
        }
        
        // ç”Ÿæˆæœˆä»½åˆ—è¡¨
        function generateMonthList(startMonth, endMonth) {
            const months = [];
            const startYear = parseInt(startMonth.substring(0, 4));
            const startMonthNum = parseInt(startMonth.substring(4, 6));
            const endYear = parseInt(endMonth.substring(0, 4));
            const endMonthNum = parseInt(endMonth.substring(4, 6));
            
            let currentYear = startYear;
            let currentMonth = startMonthNum;
            
            while (currentYear < endYear || (currentYear === endYear && currentMonth <= endMonthNum)) {
                const monthStr = currentYear.toString() + currentMonth.toString().padStart(2, '0');
                months.push(monthStr);
                
                currentMonth++;
                if (currentMonth > 12) {
                    currentMonth = 1;
                    currentYear++;
                }
            }
            
            return months;
        }
        
        // æ›´æ–°è¡¨æ•°é‡ä¿¡æ¯
        function updateTableCount() {
            const tableNamesText = document.getElementById('tableNames').value.trim();
            const tableNames = parseTableNames(tableNamesText);
            
            if (tableNames.length > 0) {
                const startMonth = document.getElementById('startMonth').value.trim();
                const endMonth = document.getElementById('endMonth').value.trim();
                
                if (/^\d{6}$/.test(startMonth) && /^\d{6}$/.test(endMonth)) {
                    try {
                        const months = generateMonthList(startMonth, endMonth);
                        document.getElementById('tableCountInfo').textContent = 
                            `æ£€æµ‹åˆ° ${tableNames.length} ä¸ªè¡¨ï¼Œå°†ç”Ÿæˆ ${tableNames.length * months.length} ä¸ªåˆ†è¡¨`;
                    } catch (e) {
                        document.getElementById('tableCountInfo').textContent = 
                            `æ£€æµ‹åˆ° ${tableNames.length} ä¸ªè¡¨`;
                    }
                } else {
                    document.getElementById('tableCountInfo').textContent = 
                        `æ£€æµ‹åˆ° ${tableNames.length} ä¸ªè¡¨`;
                }
            } else {
                document.getElementById('tableCountInfo').textContent = '';
            }
        }
        
        // ç”ŸæˆSQLè¯­å¥
        function generateSQL() {
            const tableNamesText = document.getElementById('tableNames').value.trim();
            const refMonth = document.getElementById('refMonth').value.trim();
            const startMonth = document.getElementById('startMonth').value.trim();
            const endMonth = document.getElementById('endMonth').value.trim();
            
            // éªŒè¯è¾“å…¥
            if (!tableNamesText) {
                alert("è¯·è¾“å…¥è¡¨å");
                return;
            }
            
            const tableNames = parseTableNames(tableNamesText);
            
            if (tableNames.length === 0) {
                alert("æœªæ‰¾åˆ°æœ‰æ•ˆçš„è¡¨åï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼");
                return;
            }
            
            if (!/^\d{6}$/.test(refMonth)) {
                alert("å‚è€ƒæœˆä»½æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¾“å…¥6ä½æ•°å­—ï¼ˆå¦‚ï¼š202511ï¼‰");
                return;
            }
            
            if (!/^\d{6}$/.test(startMonth) || !/^\d{6}$/.test(endMonth)) {
                alert("æœˆä»½èŒƒå›´æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¾“å…¥6ä½æ•°å­—ï¼ˆå¦‚ï¼š202501ï¼‰");
                return;
            }
            
            const startYear = parseInt(startMonth.substring(0, 4));
            const startMonthNum = parseInt(startMonth.substring(4, 6));
            const endYear = parseInt(endMonth.substring(0, 4));
            const endMonthNum = parseInt(endMonth.substring(4, 6));
            
            if (startYear > endYear || (startYear === endYear && startMonthNum > endMonthNum)) {
                alert("å¼€å§‹æœˆä»½ä¸èƒ½æ™šäºç»“æŸæœˆä»½");
                return;
            }
            
            // ç”Ÿæˆæœˆä»½åˆ—è¡¨
            const months = generateMonthList(startMonth, endMonth);
            
            // ç”ŸæˆSQLè¯­å¥
            let sql = `-- åˆ†è¡¨å»ºè¡¨è¯­å¥ç”Ÿæˆç»“æœ\n`;
            sql += `-- ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}\n`;
            sql += `-- å‚è€ƒæœˆä»½: ${refMonth}\n`;
            sql += `-- åˆ†è¡¨æœˆä»½èŒƒå›´: ${startMonth} åˆ° ${endMonth}\n`;
            sql += `-- è¡¨æ•°é‡: ${tableNames.length} ä¸ª\n`;
            sql += `-- æœˆä»½æ•°é‡: ${months.length} ä¸ª\n\n`;
            
            // ä¸ºæ¯ä¸ªè¡¨ç”Ÿæˆæ¯ä¸ªæœˆä»½çš„åˆ†è¡¨è¯­å¥
            let totalTables = 0;
            tableNames.forEach((tableName, tableIndex) => {
                sql += `-- ${tableName} çš„åˆ†è¡¨è¯­å¥\n`;
                
                months.forEach(month => {
                    sql += `create table ${tableName}_${month} as (select * from ${tableName}_${refMonth} where 1=0);\n`;
                    totalTables++;
                });
                
                // å¦‚æœä¸æ˜¯æœ€åä¸€ä¸ªè¡¨ï¼Œæ·»åŠ ç©ºè¡Œåˆ†éš”
                if (tableIndex < tableNames.length - 1) {
                    sql += `\n`;
                }
            });
            
            sql += `\n-- å…±ç”Ÿæˆ ${totalTables} ä¸ªåˆ†è¡¨`;
            
            // æ˜¾ç¤ºç»“æœ
            document.getElementById('sqlResult').textContent = sql;
            
            // æ›´æ–°ç»“æœç»Ÿè®¡
            document.getElementById('resultStats').textContent = 
                `${tableNames.length}ä¸ªè¡¨ Ã— ${months.length}ä¸ªæœˆä»½ = ${totalTables}ä¸ªåˆ†è¡¨`;
        }
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard() {
            const sqlResult = document.getElementById('sqlResult');
            const text = sqlResult.textContent;
            
            if (!text || text.includes("è¯·å¡«å†™å·¦ä¾§çš„é…ç½®ä¿¡æ¯")) {
                alert("æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹ï¼Œè¯·å…ˆç”ŸæˆSQLè¯­å¥");
                return;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                const copyBtn = document.querySelector('.copy-btn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = "å·²å¤åˆ¶!";
                copyBtn.style.backgroundColor = "#1e7e34";
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.backgroundColor = "#28a745";
                }, 2000);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶");
            });
        }
        
        // é‡ç½®è¡¨å•
        function resetForm() {
            const lastMonth = getLastMonth();
            const monthBeforeLast = getMonthBeforeLast();
            const firstMonthOfYearBeforeLastMonth = getFirstMonthOfYearBeforeLastMonth();
            
            // æ¸…ç©ºç¼“å­˜
            clearCache();
            
            // é‡ç½®è¡¨å•å€¼
            document.getElementById('tableNames').value = '';
            document.getElementById('refMonth').value = lastMonth;
            document.getElementById('startMonth').value = firstMonthOfYearBeforeLastMonth;
            document.getElementById('endMonth').value = monthBeforeLast;
            
            // æ¸…ç©ºç»“æœ
            document.getElementById('sqlResult').textContent = "è¯·å¡«å†™å·¦ä¾§çš„é…ç½®ä¿¡æ¯ï¼Œç„¶åç‚¹å‡»\"ç”Ÿæˆå»ºè¡¨è¯­å¥\"æŒ‰é’®";
            document.getElementById('tableCountInfo').textContent = "";
            document.getElementById('resultStats').textContent = "";
            
            // ä¿å­˜é‡ç½®åçš„å€¼åˆ°ç¼“å­˜
            saveToCache('tableNames', document.getElementById('tableNames').value);
            saveToCache('refMonth', lastMonth);
            saveToCache('startMonth', firstMonthOfYearBeforeLastMonth);
            saveToCache('endMonth', monthBeforeLast);
            
            // æ›´æ–°è¡¨æ•°é‡ä¿¡æ¯
            updateTableCount();
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            // åˆå§‹åŒ–æœˆä»½é€‰æ‹©å™¨
            initMonthPicker();
            
            // åˆå§‹åŒ–è¡¨å•æ•°æ®ï¼ˆä»ç¼“å­˜åŠ è½½æˆ–ä½¿ç”¨é»˜è®¤å€¼ï¼‰
            initFormData();
            
            // è‡ªåŠ¨ç”Ÿæˆç¤ºä¾‹SQL
            generateSQL();
        };
    </script>
</body>
</html>