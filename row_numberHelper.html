<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>表字段管理工具</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.5;
            padding: 15px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            height: 95vh;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 20px 30px;
            text-align: center;
            flex-shrink: 0;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        h1 i {
            font-size: 2.2rem;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .main-content {
            display: flex;
            padding: 20px;
            gap: 20px;
            flex: 1;
            overflow: hidden;
        }
        
        .section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .section-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f0f2f5;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title i {
            color: #6a11cb;
        }
        
        .input-container, .output-container {
            background-color: #f9fafc;
            border-radius: 10px;
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .input-field-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #444;
            font-size: 0.95rem;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
            flex: 1;
        }
        
        input:focus, textarea:focus {
            border-color: #6a11cb;
            box-shadow: 0 0 0 3px rgba(106, 17, 203, 0.1);
            outline: none;
        }
        
        button {
            padding: 10px 20px;
            background-color: #6a11cb;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        button:hover {
            background-color: #5a0db3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .fields-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            min-height: 0;
        }
        
        .no-fields {
            text-align: center;
            color: #95a5a6;
            font-style: italic;
            padding: 30px 15px;
        }
        
        .field-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: white;
            padding: 10px 12px;
            margin-bottom: 6px;
            border-radius: 6px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
            border-left: 3px solid #6a11cb;
            transition: all 0.2s;
        }
        
        .field-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
        }
        
        .field-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .field-index {
            background-color: #6a11cb;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.85rem;
        }
        
        .field-text {
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .alias {
            color: #6a11cb;
            font-weight: 700;
        }
        
        .field-name {
            color: #2c3e50;
        }
        
        .field-actions {
            display: flex;
            gap: 6px;
        }
        
        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .delete-btn {
            background-color: #ffeaea;
            color: #e74c3c;
        }
        
        .delete-btn:hover {
            background-color: #e74c3c;
            color: white;
        }
        
        .output-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 2px solid #f0f2f5;
        }
        
        .copy-all-btn {
            background: linear-gradient(135deg, #2575fc 0%, #6a11cb 100%);
            padding: 12px 24px;
            font-size: 1rem;
        }
        
        .copy-all-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(106, 17, 203, 0.25);
        }
        
        .field-count {
            font-weight: 600;
            color: #6a11cb;
            font-size: 1.1rem;
        }
        
        .input-hint {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 6px;
        }
        
        .auto-load-hint {
            font-size: 0.85rem;
            color: #2ecc71;
            font-weight: 600;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .auto-load-hint i {
            font-size: 1rem;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #2ecc71;
            color: white;
            padding: 14px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification.error {
            background-color: #e74c3c;
        }
        
        .notification i {
            font-size: 1.2rem;
        }
        
        .divider {
            width: 1px;
            background-color: #f0f2f5;
            margin: 0 15px;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-value {
            font-weight: 600;
            color: #6a11cb;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
                padding: 15px;
                gap: 20px;
            }
            
            .divider {
                display: none;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .field-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .field-actions {
                align-self: flex-end;
            }
            
            .output-controls {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .container {
                height: auto;
                min-height: 95vh;
            }
            
            .stats {
                flex-direction: column;
                gap: 8px;
            }
        }
        
        @media (max-height: 700px) {
            .container {
                height: auto;
                min-height: 95vh;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-table"></i> 表字段管理工具</h1>
            <p class="subtitle">输入表别名和多行字段名，自动生成、管理和复制SQL字段</p>
        </header>
        
        <div class="main-content">
            <div class="section">
                <h2 class="section-title"><i class="fas fa-arrow-right-to-bracket"></i> 输入区域</h2>
                <div class="input-container">
                    <div class="input-field-group">
                        <label for="alias-input"><i class="fas fa-tag"></i> 表别名（可选）</label>
                        <input type="text" id="alias-input" placeholder="例如: user, order, product（可不填）">
                        <p class="input-hint">输入表的别名，会自动转为大写字母。不输入则只显示字段名</p>
                    </div>
                    
                    <div class="input-field-group">
                        <label for="exclude-input"><i class="fas fa-filter"></i> 排除字段（用空格或逗号分隔）</label>
                        <input type="text" id="exclude-input" placeholder="例如: id, create_time, update_time（可不填）">
                        <p class="input-hint">输入要排除的字段名，用空格或逗号分隔。自动忽略SQL保留字（如PARTITION BY, ORDER BY等）</p>
                    </div>
                    
                    <div class="input-field-group" style="flex: 1; display: flex; flex-direction: column;">
                        <label for="field-input"><i class="fas fa-key"></i> 字段列表（每行一个字段）</label>
                        <textarea id="field-input" placeholder="在此输入字段名称，每行一个字段"></textarea>
                        <p class="input-hint">每行输入一个字段名称，输入内容会自动加载到输出区域</p>
                        <div class="auto-load-hint">
                            <i class="fas fa-sync-alt"></i> 自动加载已启用
                        </div>
                    </div>
                    
                    <div class="stats">
                        <div class="stat-item">
                            <span>输入字段数:</span>
                            <span class="stat-value" id="input-field-count">0</span>
                        </div>
                        <div class="stat-item">
                            <span>排除字段数:</span>
                            <span class="stat-value" id="exclude-field-count">0</span>
                        </div>
                        <div class="stat-item">
                            <span>过滤后字段数:</span>
                            <span class="stat-value" id="filtered-field-count">0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="divider"></div>
            
            <div class="section">
                <h2 class="section-title"><i class="fas fa-table-cells"></i> 输出区域</h2>
                <div class="output-container">
                    <div class="fields-list" id="fields-container">
                        <div class="no-fields" id="no-fields-message">
                            <i class="fas fa-info-circle" style="font-size: 2rem; margin-bottom: 12px; display: block; color: #bdc3c7;"></i>
                            <p>暂无字段，请在左侧输入字段</p>
                        </div>
                    </div>
                    
                    <div class="output-controls">
                        <div>
                            <p>字段总数: <span class="field-count" id="field-count">0</span></p>
                        </div>
                        <button id="copy-all-btn" class="copy-all-btn">
                            <i class="fas fa-copy"></i> 复制所有字段
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text">字段已加载到输出区域！</span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const aliasInput = document.getElementById('alias-input');
            const excludeInput = document.getElementById('exclude-input');
            const fieldInput = document.getElementById('field-input');
            const fieldsContainer = document.getElementById('fields-container');
            const noFieldsMessage = document.getElementById('no-fields-message');
            const copyAllBtn = document.getElementById('copy-all-btn');
            const fieldCount = document.getElementById('field-count');
            const inputFieldCount = document.getElementById('input-field-count');
            const excludeFieldCount = document.getElementById('exclude-field-count');
            const filteredFieldCount = document.getElementById('filtered-field-count');
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            // 存储字段的数组
            let fields = [];
            
            // 防抖计时器
            let debounceTimer = null;
            
            // SQL保留字列表（忽略大小写）
            const sqlReservedWords = [
                'PARTITION BY', 'ORDER BY', 'ROW_NUMBER', 'DESC', 'ASC', 
                'SELECT', 'FROM', 'WHERE', 'GROUP BY', 'HAVING', 'LIMIT',
                'OFFSET', 'JOIN', 'INNER JOIN', 'LEFT JOIN', 'RIGHT JOIN',
                'FULL JOIN', 'ON', 'AS', 'DISTINCT', 'UNION', 'UNION ALL',
                'EXISTS', 'IN', 'NOT IN', 'BETWEEN', 'LIKE', 'IS NULL',
                'IS NOT NULL', 'AND', 'OR', 'NOT', 'CASE', 'WHEN', 'THEN',
                'ELSE', 'END', 'OVER', 'RANK', 'DENSE_RANK', 'LEAD', 'LAG',
                'FIRST_VALUE', 'LAST_VALUE', 'COUNT', 'SUM', 'AVG', 'MIN',
                'MAX', 'CAST', 'CONVERT', 'COALESCE', 'NULLIF'
            ];
            
            // 从localStorage加载已保存的字段
            loadFieldsFromStorage();
            
            // 复制所有字段按钮点击事件
            copyAllBtn.addEventListener('click', copyAllFields);
            
            // 为输入框添加输入事件监听
            aliasInput.addEventListener('input', handleInputChange);
            excludeInput.addEventListener('input', handleInputChange);
            fieldInput.addEventListener('input', handleInputChange);
            
            // 输入变化处理函数（防抖）
            function handleInputChange() {
                // 清除之前的计时器
                if (debounceTimer) {
                    clearTimeout(debounceTimer);
                }
                
                // 设置新的计时器，延迟500ms执行加载
                debounceTimer = setTimeout(loadFields, 500);
            }
            
            // 解析排除字段输入
            function parseExcludeFields(excludeText) {
                if (!excludeText.trim()) {
                    return [];
                }
                
                // 将SQL保留字替换为空字符串（不区分大小写）
                let cleanedText = excludeText.toUpperCase();
                sqlReservedWords.forEach(reserved => {
                    const regex = new RegExp(reserved.toUpperCase(), 'gi');
                    cleanedText = cleanedText.replace(regex, '');
                });
                
                // 按逗号或空格分割，过滤空值
                const excludeFields = cleanedText
                    .split(/[\s,]+/)
                    .map(field => field.trim())
                    .filter(field => field !== '')
                    .map(field => field.toLowerCase());
                
                return excludeFields;
            }
            
            // 加载字段函数
            function loadFields() {
                const alias = aliasInput.value.trim();
                const fieldText = fieldInput.value.trim();
                const excludeText = excludeInput.value.trim();
                
                // 验证输入
                if (!fieldText) {
                    // 字段列表为空时不执行加载
                    return;
                }
                
                // 表别名转为大写
                const aliasUpper = alias.toUpperCase();
                
                // 按行分割字段，过滤空行和空白字符
                const fieldNames = fieldText.split('\n')
                    .map(field => field.trim())
                    .filter(field => field !== '');
                
                if (fieldNames.length === 0) {
                    // 没有有效字段时不执行加载
                    return;
                }
                
                // 解析排除字段
                const excludeFields = parseExcludeFields(excludeText);
                
                // 更新输入统计
                inputFieldCount.textContent = fieldNames.length;
                excludeFieldCount.textContent = excludeFields.length;
                
                // 清空原来的字段数组
                fields = [];
                
                // 统计添加的字段数量
                let addedCount = 0;
                let filteredCount = 0;
                
                // 为每个字段名创建字段对象（排除指定的字段）
                fieldNames.forEach(fieldName => {
                    // 检查字段是否在排除列表中（不区分大小写）
                    if (excludeFields.includes(fieldName.toLowerCase())) {
                        filteredCount++;
                        return; // 跳过排除的字段
                    }
                    
                    const newField = {
                        id: Date.now() + Math.random(),
                        alias: aliasUpper,
                        name: fieldName,
                        // 如果表别名为空，则只显示字段名
                        fullText: aliasUpper ? `${aliasUpper}.${fieldName}` : fieldName
                    };
                    
                    fields.push(newField);
                    addedCount++;
                });
                
                // 更新过滤后字段数
                filteredFieldCount.textContent = addedCount;
                
                // 更新UI
                updateFieldsList();
                
                // 保存到localStorage
                saveFieldsToStorage();
                
                // 显示成功通知
                let message = `已自动加载 ${addedCount} 个字段到输出区域！`;
                if (filteredCount > 0) {
                    message += ` 过滤了 ${filteredCount} 个字段。`;
                }
                showNotification(message);
            }
            
            // 更新字段列表显示
            function updateFieldsList() {
                // 更新字段计数
                fieldCount.textContent = fields.length;
                
                // 如果没有字段，显示提示信息
                if (fields.length === 0) {
                    noFieldsMessage.style.display = 'block';
                    // 清空容器
                    fieldsContainer.innerHTML = '';
                    return;
                }
                
                // 隐藏"无字段"提示
                noFieldsMessage.style.display = 'none';
                
                // 清空容器
                fieldsContainer.innerHTML = '';
                
                // 为每个字段创建DOM元素
                fields.forEach((field, index) => {
                    const fieldElement = document.createElement('div');
                    fieldElement.className = 'field-item';
                    fieldElement.dataset.id = field.id;
                    
                    // 根据是否有别名决定显示方式
                    const fieldDisplay = field.alias ? 
                        `<span class="alias">${field.alias}.</span><span class="field-name">${field.name}</span>` : 
                        `<span class="field-name">${field.name}</span>`;
                    
                    fieldElement.innerHTML = `
                        <div class="field-info">
                            <div class="field-index">${index + 1}</div>
                            <div class="field-text">
                                ${fieldDisplay}
                            </div>
                        </div>
                        <div class="field-actions">
                            <div class="action-btn delete-btn" title="删除此字段">
                                <i class="fas fa-times"></i>
                            </div>
                        </div>
                    `;
                    
                    // 添加到容器
                    fieldsContainer.appendChild(fieldElement);
                    
                    // 添加删除按钮事件
                    const deleteBtn = fieldElement.querySelector('.delete-btn');
                    deleteBtn.addEventListener('click', () => deleteField(field.id));
                });
            }
            
            // 删除字段
            function deleteField(id) {
                // 从数组中删除对应字段
                const fieldToDelete = fields.find(field => field.id === id);
                fields = fields.filter(field => field.id !== id);
                
                // 更新UI
                updateFieldsList();
                
                // 保存到localStorage
                saveFieldsToStorage();
                
                // 显示通知
                const fieldName = fieldToDelete.alias ? 
                    `${fieldToDelete.alias}.${fieldToDelete.name}` : 
                    fieldToDelete.name;
                showNotification(`已删除字段 ${fieldName}`);
            }
            
            // 复制所有字段
            function copyAllFields() {
                if (fields.length === 0) {
                    showNotification('没有字段可复制！', true);
                    return;
                }
                
                // 生成字段字符串，每行一个字段，不使用逗号分隔
                const allFieldsText = fields.map(field => field.fullText).join('\n');
                
                // 复制到剪贴板
                navigator.clipboard.writeText(allFieldsText)
                    .then(() => {
                        showNotification(`已复制 ${fields.length} 个字段到剪贴板！`);
                    })
                    .catch(err => {
                        console.error('复制失败: ', err);
                        
                        // 备用方法：使用textarea
                        const textArea = document.createElement('textarea');
                        textArea.value = allFieldsText;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        
                        showNotification(`已复制 ${fields.length} 个字段到剪贴板！`);
                    });
            }
            
            // 显示通知
            function showNotification(message, isError = false) {
                notificationText.textContent = message;
                
                if (isError) {
                    notification.className = 'notification error';
                } else {
                    notification.className = 'notification';
                }
                
                notification.classList.add('show');
                
                // 3秒后隐藏通知
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            // 保存字段到localStorage
            function saveFieldsToStorage() {
                localStorage.setItem('tableFields', JSON.stringify(fields));
            }
            
            // 从localStorage加载字段
            function loadFieldsFromStorage() {
                const savedFields = localStorage.getItem('tableFields');
                if (savedFields) {
                    try {
                        fields = JSON.parse(savedFields);
                        updateFieldsList();
                    } catch (e) {
                        console.error('加载保存的字段时出错:', e);
                        fields = [];
                    }
                }
            }
        });
    </script>
</body>
</html>
