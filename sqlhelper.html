<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Work-Helper</title>
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">
    <!-- jQuery and JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
</head>
<style>

    textarea:focus,
    input[type="text"]:focus,
    input[type="password"]:focus,
    input[type="datetime"]:focus,
    input[type="datetime-local"]:focus,
    input[type="date"]:focus,
    input[type="month"]:focus,
    input[type="time"]:focus,
    input[type="week"]:focus,
    input[type="number"]:focus,
    input[type="email"]:focus,
    input[type="url"]:focus,
    input[type="search"]:focus,
    input[type="tel"]:focus,
    input[type="color"]:focus,
    .uneditable-input:focus {   
    border-color: rgba(201, 104, 239, 0.8);
    box-shadow: 0 1px 1px rgba(0, 0, 0, 0.075) inset, 0 0 8px rgba(126, 239, 104, 0.6);
    outline: 0 none;
    background-color:transparent;
    }

    ::-webkit-input-placeholder { /* WebKit, Blink, Edge */
        color: red!important;
    }
    :-moz-placeholder { /* Mozilla Firefox 4 to 18 */
        color: red!important;
    }
    ::-moz-placeholder { /* Mozilla Firefox 19+ */
        color: red!important;
    }
    :-ms-input-placeholder { /* Internet Explorer 10-11 */
        color: red!important;
    }
    .form-control{
        background-color: transparent;
        border:1px solid #bb36a6;
    }
    .input-group-text{
        background-color: transparent;
        border:1px solid #bb36a6;
        color: #97353d;
    }
    .m{
        background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#f393f0), to(#fdc3c3))
    }
    .trans{
        background-color: transparent;
    }
    .bd-example {
        padding: 1.5rem;
        margin-right: 0;
        margin-left: 0;
        border-width: 1px;
        border-top-left-radius: .25rem;
        border-top-right-radius: .25rem;
    }
    .hide{
        display: none;
    }
    .autocopy{
        border-color:rgb(156, 122, 88);
    }
</style>
<script>
    var copy_txt = function () {//无组件复制
            var _this = this;
            this.copy = function (txt) {

                $("#input_copy_txt_to_board").val(txt);//赋值
                $("#input_copy_txt_to_board").removeClass("hide");//显示
                $("#input_copy_txt_to_board").focus();//取得焦点
                $("#input_copy_txt_to_board").select();//选择
                document.execCommand("Copy");
                $("#input_copy_txt_to_board").addClass("hide");//隐藏
            }

            //-----------
            let html = '<textarea type class="hide" id="input_copy_txt_to_board" value="" /></textarea>';//添加一个隐藏的元素
            $("body").append(html);
        }
    Date.prototype.format = function (fmt) {
            var o = {
                "M+": this.getMonth() + 1, //月份
                "d+": this.getDate(), //日
                "h+": this.getHours(), //小时
                "m+": this.getMinutes(), //分
                "s+": this.getSeconds(), //秒
                "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                "S": this.getMilliseconds() //毫秒
            };
            if (/(y+)/.test(fmt))
                fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
                if (new RegExp("(" + k + ")").test(fmt))
                    fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return fmt;
        }
    $(document).ready(function () {
        if(localStorage.getItem("order_no2")!=undefined){
            $("#order_no2").val(localStorage.getItem("order_no2"));
        }
        if(localStorage.getItem("operator")!=undefined){
            $("#operator").val(localStorage.getItem("operator"));
        }
        if(localStorage.getItem("me")!=undefined){
            $("#me").val(localStorage.getItem("me"));
        }

        $("input").attr("autocomplete","off");
        $("#tip1").val(
                'beeline'+'\n'+'use szdsjsxm_sj;'+'\n'+'set hive.execution.engine=spark;'+'\n'+'set hive.exec.parallel=true;'+'\n'+'set hive.exec.mode.local.auto=true;'+'\n'

            );
        $("#tip2").val(
                'spark-beeline\n'
            );

            $("#order_no,#order_no2").click(function(){
                $(this).select();
            });
        $("#generate1").click(function () {
            $("#helper").show();
            $("#alltips").addClass("hide");
            var date = new Date().format("yyyyMMdd");
            var me=$("#me").val();
            me=me==""? $("#me").attr("placeholder"):me;
            var order_no=$("#order_no").val();
            order_no=order_no==""? $("#order_no").attr("placeholder"):order_no;
            var order_no_last6=order_no.substring(order_no.length-6);
            var tablename = $("#tablename").val();
            tablename=tablename==""? $("#tablename").attr("placeholder"):tablename;
            var tablealias = $("#tablealias").val();
            tablealias=tablealias==""? $("#tablealias").attr("placeholder"):tablealias;
            var fq=$("#fq").val();
            // fq=fq==""? $("#fq").attr("placeholder"):fq;
            var px=$("#px").val();
            px=px==""? $("#px").attr("placeholder"):px;
            if($("#me").val()!=""){
                localStorage.setItem("me",me);
            }else{
                localStorage.removeItem("me");
            }


            $("#result").val("create table szdsjsxm_sj."+me+"_"+date+"_"+order_no_last6+"_"+
            "\nrow format delimited fields terminated by '|' stored as textfile tblproperties (\n'serialization.null.format' = '',\n'serialization.encoding' = 'GBK'\n) as\n");
            $("#upload_tip").val(
                "zip -re "+order_no+".zip"+"\n"+
                "put "+order_no+".zip"+"\n"+
                "mv /home/zengy/"+order_no+".zip"+" ./"+order_no+".zip"+"\n"+
                "chmod 777 ./"+order_no+".zip"
            );
            var partition_by=fq==""?fq:"partition by "+fq+" ";
            $("#sql_tip").text(
                "select * from (select a.*,row_number() over("+partition_by+"order by "+px+") rn"+tablealias+" from "+tablename + " a) "+tablealias+" where rn"+tablealias+"=1;"
            );
            var cc=$("#cc").val();
            cc=cc==""? $("#cc").attr("placeholder"):cc;
            $("#sql_tip2").text(
                "select" + "\n" +
                "    count(1)," + "\n" +
                "    count("+cc+")," + "\n" +
                "    count(distinct "+cc+")" + "\n" +
                "from" + "\n" +
                "    "+tablename + " " + tablealias + ";"
            );
            var lastmonth=new Date(new Date().setMonth((new Date().getMonth()-1))).format("yyyyMM");
            console.log(lastmonth);
            $("#sql_tip3").text(
                "select" + "\n" +
                "    day," + "\n" +
                "    count(1)," + "\n" +
                "    count("+cc+")," + "\n" +
                "    count(distinct "+cc+")" + "\n" +
                "from" + "\n" +
                "    "+tablename + " " + tablealias + "\n" +
                "where" + "\n" +
                "    month = 202109" + "\n" +
                "    and day in(" + lastmonth * 10 + 1 + "," + lastmonth * 10 + 5 + "," + lastmonth * 1 + 10 + ")" + "\n" +
                "group by" + "\n" +
                "    day;"
            );
            var year=$("#year").val();
            year=year==""? $("#year").attr("placeholder"):year;
            var febday=28;
            if(year%4==0&&year%100!=0||year%400==0){
                febday=29
            }
            $("#tip4").text(
                year+"01,"+year+"02,"+year+"03,"+year+"04,"+year+"05,"+year+"06,"+year+"07,"+year+"08,"+
                year+"09,"+year+"10,"+year+"11,"+year+"12"+"\n"+
                year+"0101,"+year+"02"+febday+","+year+"0331,"+year+"0430,"+year+"0531,"+year+"0630,"+year+"0731,"+
                year+"0831,"+year+"0930,"+year+"1031,"+year+"1130,"+year+"1231"
            );



        });
        $("#generate1").click();
        $(".page1").keyup(function(){
            $("#generate1").click();
        });


        var ct =new copy_txt();  
        $("input").each(function(){
            var val=$(this).val();
            ct.copy(val);
        });
        $('.autocopy').on('click', function () {
            $(this).select();
            var val1=$(this).val();
            var val2=$(this).text();
            var val=val2==""?val1:val2;
            ct.copy(val);
            $(this).select();
            $(this).blur();
        });
        $("#mytips").click(function () {
            $("#helper").hide();
            $("#alltips").removeClass("hide");
            huidan();
        })
        $("#wod,#order_no2,#workhours,#appendix,#operator").keyup(huidan);

    });
    function huidan(){
        var wod=$("#wod").val();
        var order_no=$("#order_no2").val();
        order_no=order_no==""? $("#order_no2").attr("placeholder"):order_no;
        var operator=$("#operator").val();
        operator=operator==""? $("#operator").attr("placeholder"):operator;
        var workhours=$("#workhours").val();
        workhours=workhours==""? $("#workhours").attr("placeholder"):workhours;
        var appendix=$("#appendix").val();
        appendix=appendix==""? $("#appendix").attr("placeholder"):appendix;
        if($("#order_no2").val()!=""){
            localStorage.setItem('order_no2',order_no);
        }else{
                localStorage.removeItem("order_no2");
            }
        if($("#operator").val()!=""){
            localStorage.setItem('operator',operator);
        }else{
                localStorage.removeItem("operator");
            }
        $("#huidan1").val(
            "该需求"+wod+",已将取数结果上传至下载中心，文件地址：/ftpdsjs/sz/tmp/"+order_no+".zip。处理人:"+operator+",工作量："+workhours+"h，请审核，谢谢！"
        );
        $("#huidan2").val(
            "该需求"+wod+",已将结果上传至附件："+appendix+"。处理人:"+operator+",工作量："+workhours+"h，请审核，谢谢！"
        );
        $("#huidan3").val(
            "该需求"+wod+",已将统计结果上传至附件："+appendix+",清单已上传至下载中心，文件地址：/ftpdsjs/sz/tmp/"+order_no+".zip。处理人:"+operator+",工作量："+workhours+"h，请审核，谢谢！"
        );
    }

</script>

<body class="m">
    <div class="container">
        <div class="bd-example">
            <img class="logo" src="images/Logox.png" width="150px" alt="Logo">
            <button id="generate1" type="button" class="btn btn-outline-primary">生成</button>
            <button id="mytips" type="button" class="btn btn-outline-success">TIPS</button>
            <!-- <button type="button" class="btn btn-outline-secondary">Secondary</button>
            <button type="button" class="btn btn-outline-danger">Danger</button>
            <button type="button" class="btn btn-outline-warning">Warning</button>
            <button type="button" class="btn btn-outline-info">Info</button>
            <button type="button" class="btn btn-outline-light">Light</button>
            <button type="button" class="btn btn-outline-dark">Dark</button> -->
        </div>
        <div id="helper" class="row">
            <div class="col-sm-5">
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1">表名</span>
                    <input id="tablename" type="text" class="form-control page1" placeholder="jcfw.TW_NET_ROAM_OUT_TRACE_D_SZ" aria-label="jcfw.TW_NET_ROAM_OUT_TRACE_D_SZ"
                    aria-describedby="basic-addon1">
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon2">表别名</span>
                    <input id="tablealias" type="text" class="form-control page1" placeholder="a" aria-label="a"
                    aria-describedby="basic-addon2">
                    <span class="input-group-text" id="basic-addon12">年份</span>
                    <input id="year" type="text" class="form-control page1" placeholder="2021" aria-label="2021"
                    aria-describedby="basic-addon12">
                </div>

                <div class="input-group mb-3" >
                    <span class="input-group-text" id="basic-addon3">分区字段</span>
                    <input id="fq" type="text" class="form-control page1" placeholder="" aria-label="" 
                    aria-describedby="basic-addon3">
                    <span class="input-group-text" id="basic-addon4">排序字段</span>
                    <input id="px" type="text" class="form-control page1" placeholder="day desc" aria-label="day desc"
                    aria-describedby="basic-addon4">
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon10">查重字段</span>
                    <input id="cc" type="text" class="form-control page1" placeholder="usr_nbr" aria-label="usr_nbr"
                    aria-describedby="basic-addon10">
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text">SQL</span>
                    <code id="sql_tip" rows="12" class="form-control autocopy" aria-label="SQL"></code>
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text">SQL</span>
                    <code id="sql_tip2" rows="12" class="form-control autocopy" aria-label="SQL"></code>
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text">SQL</span>
                    <code id="sql_tip3" rows="12" class="form-control autocopy" aria-label="SQL"></code>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">TIP</span>
                    <code id="tip4" rows="12" class="form-control" aria-label="TIP"></code>
                </div>


            </div>
            <div class="col-sm-7">
                <div class="input-group mb-3">
                    <input id="me" type="text" class="form-control page1" placeholder="lta" aria-label="lta"
                    aria-describedby="me">
                    <span class="input-group-text" id="me">名字</span>
                </div>
                <div class="input-group mb-3">
                    <input id="order_no" type="text" class="form-control page1" placeholder="SJXQZC-SZ-21100900006530169425" aria-label="SJXQZC-SZ-21100900006530169425"
                    aria-describedby="basic-addon0">
                    <span class="input-group-text" id="basic-addon0">单号</span>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">上传</span>
                    <textarea  id="upload_tip" rows="5" class="form-control" aria-label="上传"></textarea>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">结果</span>
                    <textarea id="result" rows="6" class="form-control autocopy" aria-label="结果"></textarea>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">TIP</span>
                    <textarea id="tip1" rows="6" class="form-control autocopy" aria-label="tips"></textarea>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">TIP</span>
                    <textarea id="tip2" rows="2" class="form-control autocopy" aria-label="tips"></textarea>
                </div>
            </div>
        </div>

        <div id="alltips" class="row hide">
            <div class="col-sm-6">
                <div class="input-group mb-3">
                    <input id="order_no2" type="text" class="form-control" placeholder="SJXQZC-SZ-21100900006530169425" aria-label="SJXQZC-SZ-21100900006530169425"
                    aria-describedby="basic-addon0">
                    <span class="input-group-text" id="basic-addon0">单号</span>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon5">工单描述</span>
                    <input id="wod" type="text" class="form-control" placeholder="关于提取XXX的需求" aria-label="关于提取XXX的需求"
                    aria-describedby="basic-addon5">
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon6">处理人</span>
                    <input id="operator" type="text" class="form-control" placeholder="Angle" aria-label="Angle"
                    aria-describedby="basic-addon6">
                    <span class="input-group-text" id="basic-addon7">工时(小时)</span>
                    <input id="workhours" type="text" class="form-control" placeholder="8" aria-label="8"
                    aria-describedby="basic-addon7">
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon8">附件名称</span>
                    <input id="appendix" type="text" class="form-control" placeholder="result.xlsx" aria-label="result.xlsx"
                    aria-describedby="basic-addon8">
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">TIP</span>
                    <textarea id="huidan1" rows="4" class="form-control" aria-label="tips"></textarea>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">TIP</span>
                    <textarea id="huidan2" rows="3" class="form-control" aria-label="tips"></textarea>
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">TIP</span>
                    <textarea id="huidan3" rows="5" class="form-control" aria-label="tips"></textarea>
                </div>
            </div>
            <div class="col-sm-6"></div>
        </div>
    </div>



</body>

</html>